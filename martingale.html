<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Martingale Recovery Pattern — Stakes Table</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg: #0f172a;
      --card: #0b1220;
      --muted: #9aa7bf;
      --accent: #22c55e;
      --accent-hover: #16a34a;
      --secondary: #3b82f6;
      --warning: #f59e0b;
      --danger: #ef4444;
      --border: rgba(255, 255, 255, 0.06);
      --shadow: 0 6px 18px rgba(2, 6, 23, 0.6);
      --shadow-hover: 0 8px 24px rgba(2, 6, 23, 0.8);
    }
    * {
      box-sizing: border-box;
    }
    body {
      font-family: Inter, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(180deg, #07102a 0%, #071829 100%);
      color: #e6eef8;
      margin: 0;
      padding: 24px;
      line-height: 1.5;
      overflow-x: hidden;
    }
    .menu {
      display: flex;
      align-items: center;
      gap: 24px;
      margin-bottom: 32px;
      opacity: 0;
      animation: slideInDown 0.8s ease-out forwards;
    }
    .brand {
      font-weight: 700;
      font-size: 24px;
      background: linear-gradient(135deg, var(--accent), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .subtitle {
      color: var(--muted);
      font-size: 14px;
      margin-top: 4px;
    }
    .card {
      background: rgba(255, 255, 255, 0.03);
      padding: 24px;
      border-radius: 16px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      position: relative;
      overflow: hidden;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.6s ease-out forwards;
    }
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
      opacity: 0.5;
    }
    .card:hover {
      box-shadow: var(--shadow-hover);
      transform: translateY(-4px);
    }
    .card.animate-in {
      opacity: 1;
      transform: translateY(0);
    }
    label {
      display: block;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 8px;
      font-weight: 500;
      transition: color 0.2s ease;
    }
    input[type=number], select {
      width: 100%;
      max-width: 140px;
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.05);
      color: inherit;
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      font-size: 14px;
    }
    select:focus {
      outline: none;
      border-color: var(--accent);
      background: rgba(255, 255, 255, 0.08);
    }
    input[type=number]:focus {
      outline: none;
      border-color: var(--accent);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
      transform: scale(1.02);
    }
    .controls {
      display: flex;
      gap: 16px;
      align-items: end;
      flex-wrap: wrap;
    }
    .control-group {
      flex: 1;
      min-width: 120px;
      position: relative;
    }
    button {
      padding: 10px 20px;
      border-radius: 10px;
      border: none;
      background: linear-gradient(135deg, var(--accent), var(--accent-hover));
      color: #042018;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 120px;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s ease;
    }
    button:hover::before {
      left: 100%;
    }
    button:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
    }
    button:active {
      transform: translateY(0) scale(1.02);
    }
    button i {
      font-size: 14px;
      transition: transform 0.2s ease;
    }
    button:hover i {
      transform: scale(1.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
      font-size: 13px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    table.animate-in {
      opacity: 1;
      transform: translateY(0);
    }
    th, td {
      padding: 14px 12px;
      border-bottom: 1px solid var(--border);
      text-align: right;
      transition: background 0.2s ease;
    }
    th {
      color: var(--muted);
      text-align: left;
      font-weight: 500;
      background: rgba(255, 255, 255, 0.02);
    }
    tr {
      opacity: 0;
      transform: translateX(-20px);
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    tr.animate-in {
      opacity: 1;
      transform: translateX(0);
    }
    tr:nth-child(even) {
      background: rgba(255, 255, 255, 0.02);
    }
    tr:hover {
      background: rgba(34, 197, 94, 0.08);
      transform: scale(1.01) translateY(-1px);
    }
    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;
    }
    .hint {
      color: var(--muted);
      font-size: 13px;
      margin-top: 12px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 8px;
      border-left: 3px solid var(--accent);
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.4s ease-out;
    }
    .hint.animate-in {
      opacity: 1;
      transform: translateY(0);
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 12px;
    }
    .header strong {
      font-size: 18px;
      color: #fff;
      opacity: 0;
      animation: fadeIn 0.6s ease-out 0.2s forwards;
    }
    #chart-container {
      margin-top: 32px;
      height: 350px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow);
      opacity: 0;
      transform: scale(0.95);
      transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    #chart-container.animate-in {
      opacity: 1;
      transform: scale(1);
    }
    .risk-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 32px;
    }
    .risk-card {
      background: rgba(255, 255, 255, 0.02);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid var(--border);
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .risk-card.animate-in {
      opacity: 1;
      transform: translateY(0);
    }
    .risk-card h3 {
      margin: 0 0 12px 0;
      color: var(--accent);
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .risk-card ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .risk-card li {
      color: var(--muted);
      font-size: 13px;
      margin-bottom: 8px;
      padding-left: 20px;
      position: relative;
      transition: color 0.2s ease;
    }
    .risk-card li::before {
      content: '→';
      position: absolute;
      left: 0;
      color: var(--accent);
      font-weight: bold;
      transition: transform 0.2s ease;
    }
    .risk-card li:hover::before {
      transform: translateX(5px);
    }
    .bankroll-highlight, .ev-highlight, .ruin-highlight {
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      transform: scale(1);
      margin-bottom: 8px;
    }
    .bankroll-highlight {
      background: linear-gradient(135deg, var(--secondary), #1d4ed8);
      color: white;
    }
    .ev-highlight {
      background: linear-gradient(135deg, var(--warning), #d97706);
      color: white;
    }
    .ruin-highlight {
      background: linear-gradient(135deg, var(--danger), #dc2626);
      color: white;
    }
    .bankroll-highlight.animate, .ev-highlight.animate, .ruin-highlight.animate {
      transform: scale(1.05);
    }
    @keyframes slideInDown {
      from { opacity: 0; transform: translateY(-30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @media (max-width: 768px) {
      body { padding: 16px; }
      .menu { flex-direction: column; align-items: flex-start; gap: 16px; }
      .controls { flex-direction: column; gap: 12px; }
      input[type=number], select { max-width: none; }
      button { width: 100%; }
      table td, th { font-size: 12px; padding: 10px 8px; }
      #chart-container { height: 280px; }
      .risk-section { grid-template-columns: 1fr; }
      .header { flex-direction: column; align-items: flex-start; }
    }
    .text-success { color: var(--accent); }
    .text-danger { color: var(--danger); }
    .text-warning { color: var(--warning); }
  </style>
</head>
<body>
  <div class="menu">
    <div>
      <div class="brand"><i class="fas fa-chart-line"></i> Betting Progression Calculator</div>
      <div class="subtitle">Martingale Recovery or Fibonacci — with probability calculations up to 20 rounds</div>
    </div>
    <div style="margin-left: auto;">
      <div class="card">
        <div class="controls">
          <div class="control-group">
            <label for="strategy"><i class="fas fa-cogs"></i> Strategy</label>
            <select id="strategy">
              <option value="martingale">Martingale Recovery (1-2-sum)</option>
              <option value="fibonacci">Fibonacci (1-1-2-3-5...)</option>
            </select>
          </div>
          <div class="control-group">
            <label for="base"><i class="fas fa-coins"></i> Base stake (Ksh)</label>
            <input id="base" type="number" min="1" value="100" />
          </div>
          <div class="control-group">
            <label for="odds"><i class="fas fa-percentage"></i> Odds (decimal)</label>
            <input id="odds" type="number" min="1.01" step="0.01" value="2.0" />
          </div>
          <div class="control-group">
            <label for="p"><i class="fas fa-chart-pie"></i> Win Prob (p)</label>
            <input id="p" type="number" min="0" max="1" step="0.01" value="0.5" />
          </div>
          <div class="control-group">
            <label for="rounds"><i class="fas fa-sync-alt"></i> Rounds (max 20)</label>
            <input id="rounds" type="number" min="1" max="20" value="20" />
          </div>
          <div class="control-group">
            <button id="gen"><i class="fas fa-magic"></i> Generate</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card" id="output">
    <div class="header">
      <strong><i class="fas fa-table"></i> Stake & Probability Schedule</strong>
      <div class="hint">Probabilities based on win prob p. Net assumes recovery + base profit where applicable. EV = Expected Value per cycle.</div>
    </div>

    <table id="table">
      <thead>
        <tr>
          <th>Bet #</th>
          <th>Stake (× base)</th>
          <th>Stake (Ksh)</th>
          <th>Cumulative Invested (Ksh)</th>
          <th>Net if Win Here (Ksh)</th>
          <th>Prob Win Here (%)</th>
          <th>Cum. Prob Reach Here (%)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="hint"><i class="fas fa-lightbulb"></i> Tip: For fair odds, set p = 1/odds. Use probabilities to assess risk of long losing streaks.</div>

    <div id="chart-container">
      <canvas id="chart"></canvas>
    </div>
  </div>

  <div class="risk-section">
    <div class="card">
      <div class="risk-card" id="bankroll-card">
        <h3><i class="fas fa-shield-alt"></i> Bankroll Requirement</h3>
        <div id="bankroll" class="bankroll-highlight">Ksh 0 (Generate to see)</div>
        <p style="color: var(--muted); font-size: 12px; margin: 8px 0 0 0;">Minimum balance needed to complete all rounds.</p>
      </div>
    </div>
    <div class="card">
      <div class="risk-card" id="ev-card">
        <h3><i class="fas fa-calculator"></i> Expected Value (EV)</h3>
        <div id="ev" class="ev-highlight">Ksh 0 (Generate to see)</div>
        <p style="color: var(--muted); font-size: 12px; margin: 8px 0 0 0;">EV per full cycle: ∑ [P(win on k) × Net on k]. Positive EV indicates edge.</p>
      </div>
    </div>
    <div class="card">
      <div class="risk-card" id="ruin-card">
        <h3><i class="fas fa-skull-crossbones"></i> Ruin Probability</h3>
        <div id="ruin" class="ruin-highlight">0% (Generate to see)</div>
        <p style="color: var(--muted); font-size: 12px; margin: 8px 0 0 0;">Prob of losing all rounds: (1-p)^rounds. High values signal high risk.</p>
      </div>
    </div>
    <div class="card">
      <div class="risk-card" id="strategies-card">
        <h3><i class="fas fa-exclamation-triangle"></i> Risk Management Strategies</h3>
        <ul>
          <li>Limit cycles to 5-7 rounds max to avoid exponential growth.</li>
          <li>Set stop-loss: Quit after 3 consecutive losses (risk ~12.5% if p=0.5).</li>
          <li>Risk no more than 1-2% of total bankroll per cycle start.</li>
          <li>Track win rate: If below 48% for odds=2.0, reconsider strategy.</li>
          <li>Diversify: Don't put all bankroll into one progression. Monitor EV.</li>
        </ul>
      </div>
    </div>
  </div>

<script>
  let chart;
  let animationObserver;

  function animateElements() {
    // Animate cards
    const cards = document.querySelectorAll('.card');
    cards.forEach((card, index) => {
      setTimeout(() => {
        card.classList.add('animate-in');
      }, index * 100);
    });

    // Animate risk cards
    const riskCards = document.querySelectorAll('.risk-card');
    riskCards.forEach((card, index) => {
      setTimeout(() => {
        card.classList.add('animate-in');
      }, 300 + index * 150);
    });

    // Animate hints and header
    const hints = document.querySelectorAll('.hint');
    hints.forEach((hint, index) => {
      setTimeout(() => {
        hint.classList.add('animate-in');
      }, 500 + index * 100);
    });
  }

  function generate(base, odds, p, rounds, strategy) {
    const q = 1 - p;
    // stakes as multiples of base
    const stakes = [];
    const cumulatives = [];
    const nets = [];
    const probWinHere = [];
    const cumReachHere = []; // Prob of reaching this bet (q^{k-1})
    let cum = 0;
    let ev = 0;
    for (let k = 1; k <= rounds; k++) {
      let stake;
      if (strategy === 'martingale') {
        if (k === 1) stake = 1;
        else if (k === 2) stake = 2;
        else {
          const sumPrev = stakes.reduce((a, b) => a + b, 0);
          stake = sumPrev;
        }
      } else { // fibonacci
        if (k === 1 || k === 2) stake = 1;
        else stake = stakes[k-2] + stakes[k-3]; // 0-indexed: stakes[0]=1, [1]=1, [2]=2, etc.
      }
      stakes.push(stake);
      const stakeAmt = stake * base;
      cum += stakeAmt;
      cumulatives.push(cum);
      // Net if win here: payout - total invested (aim for +base where possible, but calculate actual)
      const payout = odds * stakeAmt;
      const net = payout - cum;
      nets.push(net);
      // Prob win here: q^{k-1} * p
      const pw = Math.pow(q, k-1) * p;
      probWinHere.push(pw);
      // Cum reach here: q^{k-1}
      const cr = Math.pow(q, k-1);
      cumReachHere.push(cr);
      ev += pw * net;
    }
    const ruinProb = Math.pow(q, rounds) * 100; // % chance of losing all

    // Update highlights
    const bankrollEl = document.getElementById('bankroll');
    bankrollEl.textContent = `Ksh ${cumulatives[cumulatives.length - 1].toLocaleString('en-US')}`;
    bankrollEl.classList.add('animate');
    setTimeout(() => bankrollEl.classList.remove('animate'), 400);

    const evEl = document.getElementById('ev');
    evEl.textContent = `Ksh ${ev.toFixed(2)}`;
    evEl.classList.add('animate');
    setTimeout(() => evEl.classList.remove('animate'), 400);

    const ruinEl = document.getElementById('ruin');
    ruinEl.textContent = `${ruinProb.toFixed(2)}%`;
    ruinEl.classList.add('animate');
    setTimeout(() => ruinEl.classList.remove('animate'), 400);

    // Animate table
    const table = document.getElementById('table');
    table.classList.remove('animate-in');
    setTimeout(() => table.classList.add('animate-in'), 100);

    // build table rows with staggered animation
    const tbody = document.querySelector('#table tbody');
    tbody.innerHTML = '';
    for (let i = 0; i < stakes.length; i++) {
      const mult = stakes[i];
      const stakeAmt = mult * base;
      const net = nets[i];
      const pw = (probWinHere[i] * 100).toFixed(2);
      const cr = (cumReachHere[i] * 100).toFixed(2);
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td style="text-align: left;"><strong>${i + 1}</strong></td>
        <td class="mono">${mult}×</td>
        <td class="mono">${stakeAmt.toLocaleString('en-US')}</td>
        <td class="mono">${cumulatives[i].toLocaleString('en-US')}</td>
        <td class="mono ${net >= 0 ? 'text-success' : 'text-danger'}">${net >= 0 ? '+' : ''}${net.toLocaleString('en-US')}</td>
        <td class="mono ${pw > 0 ? 'text-warning' : 'text-muted'}">${pw}%</td>
        <td class="mono">${cr}%</td>
      `;
      tbody.appendChild(tr);
      // Stagger row animation
      setTimeout(() => tr.classList.add('animate-in'), i * 80);
    }

    // Animate hints
    const tipHint = document.querySelector('#output .hint:last-child');
    tipHint.classList.remove('animate-in');
    setTimeout(() => tipHint.classList.add('animate-in'), 600);

    // build chart
    const ctx = document.getElementById('chart').getContext('2d');
    const chartContainer = document.getElementById('chart-container');
    chartContainer.classList.remove('animate-in');
    setTimeout(() => chartContainer.classList.add('animate-in'), 400);
    if (chart) chart.destroy();
    chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: stakes.map((_, i) => i + 1),
        datasets: [
          {
            label: 'Stake Multiple',
            data: stakes,
            borderColor: '#22c55e',
            backgroundColor: 'rgba(34, 197, 94, 0.1)',
            tension: 0.4,
            yAxisID: 'y',
            fill: false
          },
          {
            label: 'Cumulative Invested (Ksh)',
            data: cumulatives,
            borderColor: '#3b82f6',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            tension: 0.4,
            yAxisID: 'y1',
            fill: false
          },
          {
            label: 'Net if Win (Ksh)',
            data: nets,
            borderColor: '#f59e0b',
            backgroundColor: 'rgba(245, 158, 11, 0.1)',
            tension: 0.4,
            yAxisID: 'y1',
            fill: false
          },
          {
            label: 'Prob Win Here (%)',
            data: probWinHere.map(v => v * 100),
            borderColor: '#ef4444',
            backgroundColor: 'rgba(239, 68, 68, 0.1)',
            tension: 0.4,
            yAxisID: 'y2',
            fill: false
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
          intersect: false,
          mode: 'index'
        },
        scales: {
          y: {
            type: 'linear',
            display: true,
            position: 'left',
            title: { display: true, text: 'Stake Multiple', color: '#22c55e' }
          },
          y1: {
            type: 'linear',
            display: true,
            position: 'right',
            title: { display: true, text: 'Amount (Ksh)', color: '#3b82f6' },
            grid: { drawOnChartArea: false }
          },
          y2: {
            type: 'linear',
            display: true,
            position: 'left',
            title: { display: true, text: 'Probability (%)', color: '#ef4444' },
            grid: { drawOnChartArea: false },
            min: 0,
            max: 100
          },
          x: {
            title: { display: true, text: 'Bet Round' }
          }
        },
        plugins: {
          legend: { 
            display: true,
            position: 'top'
          },
          tooltip: {
            backgroundColor: 'rgba(0,0,0,0.8)',
            titleColor: '#fff',
            bodyColor: '#e6eef8'
          }
        },
        animation: {
          duration: 1500,
          easing: 'easeInOutQuart',
          delay: (context) => {
            let delay = 0;
            if (context.type === 'data' && context.dataIndex > 0) {
              delay = context.dataIndex * 100;
            }
            return delay;
          }
        }
      }
    });
  }

  document.getElementById('gen').addEventListener('click', () => {
    const strategy = document.getElementById('strategy').value;
    const base = Math.max(1, Number(document.getElementById('base').value) || 100);
    const odds = Math.max(1.01, parseFloat(document.getElementById('odds').value) || 2.0);
    const p = Math.max(0, Math.min(1, parseFloat(document.getElementById('p').value) || 0.5));
    let rounds = Math.min(20, Math.max(1, Number(document.getElementById('rounds').value) || 20));
    generate(base, odds, p, rounds, strategy);
  });

  // Initial animations
  document.addEventListener('DOMContentLoaded', () => {
    animateElements();
    generate(100, 2.0, 0.5, 20, 'martingale');
  });
</script>
</body>
</html>
